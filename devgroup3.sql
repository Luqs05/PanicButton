--
-- PostgreSQL database dump
--

-- Dumped from database version 9.5.9
-- Dumped by pg_dump version 9.5.9

SET statement_timeout = 0;
SET lock_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: plpgsql; Type: EXTENSION; Schema: -; Owner: 
--

CREATE EXTENSION IF NOT EXISTS plpgsql WITH SCHEMA pg_catalog;


--
-- Name: EXTENSION plpgsql; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION plpgsql IS 'PL/pgSQL procedural language';


--
-- Name: postgis; Type: EXTENSION; Schema: -; Owner: 
--

CREATE EXTENSION IF NOT EXISTS postgis WITH SCHEMA public;


--
-- Name: EXTENSION postgis; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION postgis IS 'PostGIS geometry, geography, and raster spatial types and functions';


SET search_path = public, pg_catalog;

--
-- Name: notify_event(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION notify_event() RETURNS trigger
    LANGUAGE plpgsql
    AS $$

    DECLARE 
        data json;
        notification json;
    
    BEGIN
    
        -- Convert the old or new row to JSON, based on the kind of action.
        -- Action = DELETE?             -> OLD row
        -- Action = INSERT or UPDATE?   -> NEW row
        IF (TG_OP = 'DELETE') THEN
            data = row_to_json(OLD);
        ELSE
			data = row_to_json(f)
			 FROM (SELECT 'Feature' As type
				, ST_AsGeoJSON(geom)::json As geometry
				, row_to_json((SELECT l FROM (SELECT id, type, status, accuracy, time) As l
				  )) As properties
			   FROM incident As lg order by id desc limit 1 ) As f;
        END IF;
        
        -- Contruct the notification as a JSON string.
        notification = data;
        
                        
        -- Execute pg_notify(channel, notification)
        PERFORM pg_notify('events',notification::text);
		PERFORM pg_notify('data',notification::text);
        
        -- Result is ignored since this is an AFTER trigger
        RETURN NULL; 
    END;
    
$$;


ALTER FUNCTION public.notify_event() OWNER TO postgres;

SET default_tablespace = '';

SET default_with_oids = false;

--
-- Name: incident; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE incident (
    id integer NOT NULL,
    type character varying(254) DEFAULT 'No type'::character varying,
    status character varying(254) DEFAULT 'Unattended'::character varying,
    accuracy numeric(10,0),
    "time" timestamp with time zone DEFAULT now(),
    geom geometry(Point)
);


ALTER TABLE incident OWNER TO postgres;

--
-- Name: incident_gid_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE incident_gid_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER TABLE incident_gid_seq OWNER TO postgres;

--
-- Name: incident_gid_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE incident_gid_seq OWNED BY incident.id;


--
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY incident ALTER COLUMN id SET DEFAULT nextval('incident_gid_seq'::regclass);


--
-- Data for Name: incident; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY incident (id, type, status, accuracy, "time", geom) FROM stdin;
936	Criminal Activity	Unattended	25	2018-01-11 12:23:27.796178+02	0101000020E610000051781A7AD5243C40CD3CB9A640C039C0
799	Medical Emergency	Unattended	20	2017-12-08 04:52:09.346568+02	0101000020E61000000AEB10493E243C401483763D87C039C0
944	Environmental Incident	Unattended	29	2018-01-17 15:30:30.95467+02	0101000020E6100000AE4099EBD9243C40BF3AD8AC44C039C0
948	Environmental Incident	attended	6043	2018-01-23 00:44:26.964588+02	0101000020E610000070C4A40925513C407535C35785CF39C0
764	Criminal Activity	inProgress	\N	2017-12-03 14:09:25.827368+02	0101000020E61000000100006A83323C406585492CDBB139C0
952	Environmental Incident	inProgress	\N	2018-04-28 11:00:01.753354+02	0101000020E61000000100002031923C40A4D4333423B138C0
811	Medical Emergency	Unattended	65	2017-12-09 11:33:25.011895+02	0101000020E6100000A4620A45CC243C4073BC283B4BC039C0
819	Medical Emergency	Unattended	20	2017-12-09 11:34:02.035074+02	0101000020E6100000511CF631D5243C40DF4B868840C039C0
283	Criminal Activity	attended	7	2017-11-06 01:17:43.026403+02	0101000020E6100000E25A362D4C403C40190364DCCE8C39C0
827	Medical Emergency	Unattended	23	2017-12-19 23:02:33.777792+02	0101000020E6100000F7EEEAB01D473C40658D7A8846C139C0
297	Criminal Activity	inProgress	5	2017-11-06 02:43:39.930322+02	0101000020E61000009610C0B51B633C40361388D3555F39C0
292	Criminal Activity	inProgress	6	2017-11-06 01:50:24.390939+02	0101000020E610000095312892D12A3C40950F74AEBF7639C0
281	Criminal Activity	inProgress	5	2017-11-06 01:12:16.254327+02	0101000020E61000002CA5C9D286063C40D1911460D39439C0
288	Criminal Activity	attended	4	2017-11-06 01:39:08.382056+02	0101000020E61000001E636DD2431B3C403CEEAA68299639C0
293	Criminal Activity	attended	4	2017-11-06 01:54:56.678814+02	0101000020E61000002742CB9979813C400B086215C78039C0
928	Criminal Activity	Unattended	65	2017-12-30 06:16:31.300891+02	0101000020E610000078E505CC4D6E1E40DE2F0848B9C84740
295	Criminal Activity	attended	9	2017-11-06 02:02:13.488553+02	0101000020E6100000D93925DBB4333C40D4AD02F6046439C0
932	Environmental Incident	Unattended	20	2018-01-05 04:25:36.380172+02	0101000020E610000051781A7AD5243C40CD3CB9A640C039C0
732	Medical Emergency	inProgress	\N	2017-11-16 07:04:42.932332+02	0101000020E610000001000035CC1E3C4027D9D2BFA2BB39C0
736	Medical Emergency	attended	\N	2017-11-16 08:59:02.448791+02	0101000020E61000004102001A6C483C40FB54694FD8C039C0
740	Criminal Activity	Unattended	900	2017-11-17 05:44:01.253498+02	0101000020E61000002BD0381E7D3B3C40E0956E5C10C139C0
489	Medical Emergency	inProgress	\N	2017-12-20 21:25:29.296646+02	0101000020E61000000100005087483C407BA7F46B8E3239C0
700	Medical Emergency	attended	\N	2017-11-14 13:50:02.226023+02	0101000020E6100000010000A0DE923B403C6316EA5A9B39C0
748	Medical Emergency	attended	\N	2017-11-22 04:14:40.064157+02	0101000020E6100000010000A0B6B83D40C629FCD9E64D39C0
937	Medical Emergency	Unattended	24	2018-01-11 12:23:47.522396+02	0101000020E610000051781A7AD5243C40CD3CB9A640C039C0
800	Medical Emergency	Unattended	22	2017-12-08 05:01:40.627203+02	0101000020E6100000511CF631D5243C40DF4B868840C039C0
741	Medical Emergency	attended	\N	2017-11-17 05:46:16.522236+02	0101000020E6100000010000A0E6013D40A51C6EECA6E138C0
812	Environmental Incident	Unattended	65	2017-12-09 11:33:38.418507+02	0101000020E6100000DE595EBDCC243C40C061C51E4BC039C0
820	Criminal Activity	Unattended	65	2017-12-09 11:34:52.909686+02	0101000020E6100000009DD0BCCC243C402ED2E61E4BC039C0
824	Medical Emergency	Unattended	52	2017-12-10 05:54:13.268615+02	0101000020E6100000DA7B4CFFED173C4078D1579066CE39C0
949	Medical Emergency	Unattended	20	2018-02-07 11:48:40.129428+02	0101000020E6100000270DDA50D6243C40A97A432B41C039C0
869	Criminal Activity	Unattended	17	2017-12-19 23:37:49.221819+02	0101000020E6100000D9791B9B1D473C404F852E9743C139C0
737	Medical Emergency	inProgress	\N	2017-11-16 09:05:11.487241+02	0101000020E6100000400200BA0F413C407B09A1C7AFC039C0
749	Medical Emergency	Unattended	16	2017-11-22 04:18:44.783843+02	0101000020E61000001E8F7461FF3A3C404406A85FD8C039C0
929	Criminal Activity	attended	65	2017-12-30 06:17:55.353588+02	0101000020E610000078E505CC4D6E1E40DE2F0848B9C84740
933	Medical Emergency	Unattended	24	2017-12-09 19:50:26.104683+02	0101000020E610000051781A7AD5243C40CD3CB9A640C039C0
753	Environmental Incident	attended	\N	2017-11-29 11:43:32.462924+02	0101000020E610000001000050DB7B3C405CDA34045FAE39C0
938	Environmental Incident	Unattended	24	2018-01-11 12:24:02.794834+02	0101000020E610000051781A7AD5243C40CD3CB9A640C039C0
809	Criminal Activity	Unattended	25	2017-12-08 06:37:03.669343+02	0101000020E6100000DA7B4CFFED173C4078D1579066CE39C0
942	No type	inProgress	3962	2018-01-15 09:06:58.993599+02	0101000020E6100000D0B87020247B324002AE75F39EFB40C0
821	Medical Emergency	Unattended	65	2017-12-09 11:35:12.714328+02	0101000020E6100000F4B8EC28CC243C4000D4CA414BC039C0
950	Environmental Incident	Unattended	26	2018-02-07 11:51:24.345943+02	0101000020E6100000270DDA50D6243C40A97A432B41C039C0
833	Criminal Activity	Unattended	18	2017-12-19 23:34:18.899872+02	0101000020E61000005CFC12961D473C4011EB43CD46C139C0
930	Environmental Incident	inProgress	165	2017-12-30 06:19:59.606673+02	0101000020E61000001CD9AEE9A43B1E40E22391C79DDD4740
934	Criminal Activity	Unattended	34	2017-12-09 20:40:13.358076+02	0101000020E6100000DA7B4CFFED173C40C0C5D4A766CE39C0
734	Criminal Activity	attended	1400	2017-11-16 08:53:37.513899+02	0101000020E61000002DD560753F463C40D6E07D552EC239C0
738	Medical Emergency	inProgress	\N	2017-11-16 09:10:04.508148+02	0101000020E610000081040034C32B3C401A7A04E516BB39C0
742	Criminal Activity	Unattended	700	2017-11-17 10:09:13.36472+02	0101000020E6100000502C0142353B3C403EE76ED74BC139C0
750	Medical Emergency	inProgress	\N	2017-11-22 04:21:00.993204+02	0101000020E6100000000000A0EE733B40EB05123C1A2E39C0
754	Criminal Activity	Unattended	\N	2017-11-29 11:43:43.376964+02	0101000020E610000001000050338E3B4008261040F06E39C0
758	Medical Emergency	Unattended	\N	2017-11-21 01:48:25.051533+02	0101000020E6100000010000A0D64D3D400C12DF648B4739C0
3	Criminal Activity	attended	23	2017-10-07 10:09:20+02	010100000092D17D10346C3C40D5963AC8EBB939C0
5	Medical Emergency	inProgress	27	2017-07-08 10:39:23+02	01010000001C0D7D03D5E63B402864E76D6C5E3AC0
17	Medical Emergency	inProgress	25	2017-11-08 05:11:20+02	010100000080AFAE2BE2E33B401835EBCE0B353AC0
11	Medical Emergency	inProgress	16	2017-06-07 03:09:54+02	01010000002B5925C3B7933B40FCF99DC308003AC0
19	Medical Emergency	attended	17	2017-02-05 03:20:08+02	01010000006690717B38EB3B40B7D9B342EC623AC0
15	Criminal Activity	inProgress	9	2017-09-07 16:33:42+02	0101000000D6387A80179D3C4043993E2243F039C0
2	Environmental Incident	attended	5	2017-03-08 19:39:16+02	010100000035F93D1CEAB43B409BEFB7A8DC053AC0
7	Criminal Activity	attended	28	2017-10-11 09:41:28+02	01010000009B68C2BCE8A23B40A38DA70E87FD39C0
10	Criminal Activity	attended	20	2017-07-10 19:48:25+02	0101000000D42CAFE0A75F3C40F0724B8A13713AC0
18	Environmental Incident	attended	10	2017-01-06 00:29:45+02	01010000007827C02CC4A13C402F69EF000DFE39C0
14	Medical Emergency	attended	20	2017-04-09 02:43:47+02	01010000002E4E8426EC333C4018E4B2FAB8DA39C0
12	Medical Emergency	attended	8	2017-06-11 04:00:39+02	01010000003AA3D6C953143C40481D7810969C39C0
16	Medical Emergency	attended	23	2017-01-10 08:18:33+02	0101000000FEEC6898B1073C4042B0AA5E7EAC3AC0
810	Environmental Incident	Unattended	65	2017-12-09 11:32:56.191875+02	0101000020E6100000EC47B735CC243C405C49C63E4BC039C0
747	Environmental Incident	Unattended	34	2017-11-22 04:08:50.108771+02	0101000020E6100000E96FF893E73A3C408007AB56CBC039C0
6	Environmental Incident	attended	15	2017-03-09 01:51:35+02	01010000000D10D4422C3E3C407D9608D0C6A13AC0
13	Medical Emergency	attended	32	2017-12-10 20:00:20+02	0101000000B298BFDFBB0E3C40550D4615938B3AC0
826	Medical Emergency	Unattended	18	2017-12-19 23:01:52.46812+02	0101000020E6100000FDF3D9A61D473C40D0FBB5AB46C139C0
4	Criminal Activity	attended	10	2017-08-08 17:38:27+02	010100000050ACF0BAC0373C40150854624BFB39C0
488	Criminal Activity	attended	22	2017-12-20 15:50:02.611073+02	0101000020E6100000C25C9C42F8193C40AF168ED607C839C0
1	Criminal Activity	attended	31	2017-12-07 01:51:03+02	0101000000A612965FA31D3C400798D800956C39C0
20	No type	inProgress	10	2017-08-11 02:11:51+02	0101000000FE8DC9241BB33C4004EA6A7E3E8D39C0
951	No type	Unattended	65	2018-03-15 23:22:48.700449+02	0101000020E6100000202CC6500B801E406B3289962DC04740
9	Criminal Activity	attended	27	2017-10-07 03:49:22+02	01010000003FCC986127963C4048CF5FAE668739C0
872	No type	Unattended	23	2017-12-19 23:41:34.098134+02	0101000020E610000050F234AA1D473C40CAF6C6B546C139C0
873	No type	Unattended	23	2017-12-19 23:41:34.111451+02	0101000020E610000050F234AA1D473C40CAF6C6B546C139C0
874	No type	Unattended	23	2017-12-19 23:41:34.15795+02	0101000020E610000050F234AA1D473C40CAF6C6B546C139C0
875	No type	Unattended	23	2017-12-19 23:41:34.194736+02	0101000020E610000050F234AA1D473C40CAF6C6B546C139C0
876	No type	Unattended	23	2017-12-19 23:41:34.221038+02	0101000020E610000050F234AA1D473C40CAF6C6B546C139C0
8	Environmental Incident	attended	16	2017-05-10 12:28:22+02	010100000037AFE23BCE6D3C403EBF9C97925939C0
877	No type	Unattended	23	2017-12-19 23:41:34.233274+02	0101000020E610000050F234AA1D473C40CAF6C6B546C139C0
878	No type	Unattended	23	2017-12-19 23:41:34.255152+02	0101000020E610000050F234AA1D473C40CAF6C6B546C139C0
927	Medical Emergency	Unattended	20	2017-12-30 05:34:41.519691+02	0101000020E610000051781A7AD5243C40CD3CB9A640C039C0
931	Medical Emergency	Unattended	1300	2018-01-05 04:25:26.260305+02	0101000020E6100000BE3DBE73DE253C40577C43E1B3BF39C0
935	Criminal Activity	attended	\N	2017-12-09 20:42:57.515161+02	0101000020E61000000000600098BE3B409E51871CFCAC38C0
751	Criminal Activity	inProgress	\N	2017-11-22 07:15:51.141353+02	0101000020E610000000900080CE8B3C40EB8CFDBF121139C0
387	Criminal Activity	attended	60	2017-12-15 06:11:05.399022+02	0101000020E610000061E696B1FC3A3C4022145B41D3C039C0
739	Environmental Incident	attended	50	2017-11-16 10:56:35.554925+02	0101000020E61000006253420B64473C40D234289A07C439C0
743	No type	attended	700	2017-11-17 10:09:20.11901+02	0101000020E6100000502C0142353B3C403EE76ED74BC139C0
\.


--
-- Name: incident_gid_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('incident_gid_seq', 952, true);


--
-- Data for Name: spatial_ref_sys; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY spatial_ref_sys  FROM stdin;
\.


--
-- Name: incident_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY incident
    ADD CONSTRAINT incident_pkey PRIMARY KEY (id);


--
-- Name: incident_geom_gist; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX incident_geom_gist ON incident USING gist (geom);


--
-- Name: incident_notify_event; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER incident_notify_event AFTER INSERT OR DELETE OR UPDATE ON incident FOR EACH ROW EXECUTE PROCEDURE notify_event();


--
-- Name: public; Type: ACL; Schema: -; Owner: postgres
--

REVOKE ALL ON SCHEMA public FROM PUBLIC;
REVOKE ALL ON SCHEMA public FROM postgres;
GRANT ALL ON SCHEMA public TO postgres;
GRANT ALL ON SCHEMA public TO PUBLIC;


--
-- PostgreSQL database dump complete
--

